# 计算广告

## Intro
### 商业化相关问题
+ 商业模式探索
+ 流量变现
+ 数据变现
+ 用户增长

### 免费模式
本质：能够个性化传播信息的产品，售价都会趋向其边际成本

example：
- 网站、应用：边际成本 $\approx$ 0
- 手机、电视：边际成本 $\approx$ 量产成本(举例：红米)

目的：获得其他资产，通过后向渠道变现

### 互联网三项可变现资产
- 品牌：根据用户熟悉的形象提高付费内容的**关注程度**
- 数据：根据用户偏好提高付费内容**投放效率**
- 流量：在正常(organic)内容里夹带**付费(sponsor)内容**

### 行业协会
#### iab(Interactive Advertising Bureau)
+ 在线广告供给方的行业协会，推动数字化营销行业的发展
+ 制定市场效果衡量标准和在线创意广告的标准
+ member: Google, Facebook, Yahoo, Microsoft
#### American Association of Advertising Agencies
+ 主要的协议是关于广告代理费用的收取约定，避免恶意竞争
+ 主要集中在创意和客户服务，在线业务是一部分
+ member: Ogilvy & Mather, JWI, McCann等，Dentsu等非4A会员的大公司但也被列为4A公司
#### Association of National Advertisers
+ 主要代表广告需求方的利益（也有媒体和代理会员）
+ member: AT&T,P&G,NBA etc

### 数据
#### 交易数据
业务流程中必须记录的数据

example
+ 电信：通话记录、话费
+ 银行：存取款、利息
+ 医疗：病例

特点
+ 数据规模中等
+ 一致性要求极高
#### 行为数据
业务流程中非必须记录的数据

example：
+ 互联网后台日志

特点：
+ 数据规模巨大
+ 一致性要求相对较低

### 广告形式
#### 偏直接效果型
+ Banner
+ Textual
+ Email Direct Marketing (EDM)
#### 偏品牌触达型
+ video ad
+ rich-media ad
+ 开屏广告
#### 移动广告
+ Banner
+ 开屏 (for branding)
+ 推荐墙
+ 信息流广告
#### 激励性广告
+ 下载返现
+ rewarded video(看视频得游戏道具)
#### 泛广告商业产品
+ 团购
+ 网址导航

![](./img/商业化体系大闭环.png)

### 核心挑战
计算广告的核心问题，是为一系列用户与环境的组合，找到最合适的广告投放策略以优化整体广告的利润

![](./img/优化问题描述.png)
优化的是一组广告，主要是优化收入

![](./img/广告业务的转化漏斗与目标.jpg)
$ eCPM = r(a,u,c) = \mu(a,u,c) \cdot v(a,u,c) $

$\mu(a,u,c)$ 点击率

$v(a,u,c)$ 点击价值

### 如何标识一个用户？
+ PC Web / Mobile Web环境 
    - cookie：存续性差，跨域时需要映射
+ iOS应用
    - IDFA：存续性好于cookie，但iOS10有更严格的政策(需要用户许可)
+ Android应用
    - Android ID： 存续性好于IDFA：
    - IMEI：在中国有部分使用
+ 无以上场景
    - FingerPrint (IP + User Agent): 存在http头中，可作缺省标识


### 用户模型的转化漏斗
![](./img/用户模型的转化漏斗.jpg)

### 在线广告的主要结算方式
![](./img/在线广告的主要结算方式.png)
CPC: 最主流，最合理，别的模式都需要第三方监控

CPS: cost per sale

#### CPA/CPS的问题与合理场景
存在的问题：
- 由供给方同时负责优化点击和转化率，并非普适的合理模式
- 存在劫持、代销等多种相应的灰色手段
- 用于优化的数据对于单个广告主来说严重不足
适用的场景：
- 转化流程一致且规范的广告市场
- 例：淘宝客（转化流程为淘宝统一提供）、APP下载（转化
流程在 Apple Store或 Google Play

#### CPA(cost per action) & oCPM(optimize CPM)
oCPM 按CPM结算，但不按CPM优化，按照CPA优化

## 商业化体系
### 商业化体系六大算法问题
A1: 特征提取
A2: 微观优化
A3: 宏观优化
A4: 受限优化
A5: 强化学习
A6: 重定向
### 商业化体系六大产品问题
+ 供需接口
    - 广告主（Campaign）概念上对应于广告主的一次投放合同，其中包括了预算、时间范围等基本信息。
    - 广告组（Ad Group）对应于一个具体的广告投放策略，主要是设定受众定向条件和出价。
    - 广告创意（Creative）则是最终展示出来的素材，可能在同一个组策略下有不同尺寸的创意存在。
![](./img/供需接口.png)
![](./img/供需之间的各种对接方式.png)
+ 竞价机制
+ 数据运营
+ 标签体系
+ 程序化交易
+ 原生广告

### 商业化产品系统框架
![](./img/个性化系统一般框架.png)
离线处理：慢，但可处理数量小
在线处理：快，可处理数量大

Web-scale技术问题比较
![](./img/Web-scale技术问题比较.png)

#### 广告系统特点
+ 高并发、低延迟的要求
+ 同时关注QPS和Latency
+ 数据处理的规模很大
    -（用户、环境、信息）三元组上的数据建模
+ 数据处理的速度优先于精度
+ 主流程的一致性要求不高

#### 后告系统有什么设计原则？
+ 建立弱一致性系统的设计思维方式
    - eg: Near-line page fetcher
+ 大量数据尽量环形单向流动
    - 避免集中读写形成的单点性能瓶颈
+ 在线时不要发生与关系型数据库的交互
    - 增删改查的传统需求实际上不存在
+ 充分利用开源社区的成熟技术

#### 开源软件的优势和顾虑
优势
+ 大量细分使用场景都有开源方案
+ 大型互连网公司的开源产品经过充分测试

顾虑
+ 需要仔细甄别好的和不太好的开源项目
+ 在遇到深层次bug时无能为力

核心业务逻辑不应该选择开源，eg.排序,语义检索

#### 商业化产品系统架构统一框架
![](./img/商业化产品系统架构统一框架.png)
广告库和ETL使用了关系型数据库

![](./img/商业化产品系统架构统一框架-开源.png)
Thrift: 协调不同coding language

商业化产品系统架构分解
![](./img/商业化产品系统架构分解.png)

### 商业化产品六大系统技术
+ 流量接入
    - 代码和SDK
+ 投放引擎
    - 高并发服务
+ 候选查询
    - 实时索引
+ 特征存储
    - Nosql database
+ 离线学习
    - 分布式计算
+ 在线学习
    - 流式计算

### 主要广告产品优化目标分解
![](./img/主要广告产品优化目标分解.png)

## theory
### 最优化问题
#### 无约束最优化问题
$$ min\ f(x)$$
#### 带约束最优化问题
$$ min\ f(x)$$
$$ s.t.\ g(x)\leq 0, h(x) = 0$$